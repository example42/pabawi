# Requirements Document

## Introduction

This document specifies the requirements for version 0.2.0 of Padawi, a general-purpose remote execution interface that integrates multiple infrastructure management tools. This version adds PuppetDB as the first additional integration beyond Puppet Bolt, establishing patterns for future integrations with tools like Ansible, Terraform, AWS CLI, Azure CLI, and Kubernetes. PuppetDB will serve as both a dynamic inventory source for discovering nodes and as a rich data source for displaying node facts, Puppet run reports, catalogs, and events. This version also introduces task re-execution capabilities and UI enhancements to support the multi-tool architecture.

**Priority Focus:** A key priority for this version is enhancing the expert mode experience by ensuring full visibility of command execution details. When expert mode is enabled, users must be able to see the complete command line that was executed and the full, untruncated output (stdout/stderr). This transparency is critical for debugging, auditing, and understanding exactly what operations are being performed on managed infrastructure.

## Glossary

- **Padawi**: A general-purpose remote execution interface that integrates multiple infrastructure management tools (Bolt, PuppetDB, Ansible, Terraform, etc.)
- **PuppetDB**: A centralized storage service that collects and serves data generated by Puppet, including node facts, catalogs, reports, and events
- **Inventory Source**: A system or service that provides a list of nodes available for remote execution operations
- **Node Facts**: System information collected about managed nodes (OS, hardware, network configuration, etc.)
- **Puppet Report**: A detailed record of a Puppet agent run, including resource changes, timing, and status
- **Puppet Catalog**: A compiled document describing the desired state of a node's resources
- **Puppet Event**: An individual change or action recorded during a Puppet run (resource changes, failures, etc.)
- **Action Re-execution**: The ability to run a previously executed action again with the same parameters and target nodes
- **Execution Tool**: A backend system used to perform actions (Bolt, Ansible, etc.)
- **Information Source**: A backend system that provides node data (PuppetDB, cloud APIs, etc.)
- **Node Detail Page**: The page displaying comprehensive information about a specific node from multiple sources

## Requirements

### Requirement 1

**User Story:** As an infrastructure administrator, I want to use PuppetDB as an inventory source, so that I can automatically discover and manage all nodes known to my Puppet infrastructure without manual inventory maintenance.

#### Acceptance Criteria

1. WHEN the system is configured with PuppetDB connection details THEN Padawi SHALL retrieve the list of active nodes from PuppetDB
2. WHEN PuppetDB returns node data THEN the system SHALL transform it into a normalized inventory format compatible with multiple execution tools
3. WHEN the inventory page loads THEN the system SHALL display nodes from PuppetDB alongside nodes from other inventory sources with clear source attribution
4. WHERE PuppetDB is configured as an inventory source THEN the system SHALL support filtering nodes by PuppetDB query language (PQL)
5. WHEN PuppetDB connection fails THEN the system SHALL display an error message and continue to show nodes from other available inventory sources

### Requirement 2

**User Story:** As an infrastructure administrator, I want to view node facts from PuppetDB on the node detail page, so that I can see comprehensive system information from multiple sources without running additional fact-gathering commands.

#### Acceptance Criteria

1. WHEN a user navigates to a node detail page THEN the system SHALL query PuppetDB for the latest facts for that node
2. WHEN PuppetDB returns facts THEN the system SHALL display them in a structured, searchable format with clear source attribution
3. WHEN displaying facts THEN the system SHALL organize them by category (system, network, hardware, custom)
4. WHEN facts are displayed THEN the system SHALL show the timestamp of when the facts were last updated and the source system
5. WHEN PuppetDB fact retrieval fails THEN the system SHALL display an error message while preserving other node detail functionality from other sources

### Requirement 3

**User Story:** As an infrastructure administrator, I want to view Puppet run reports from PuppetDB on the node detail page, so that I can understand the recent Puppet activity and status for each node alongside other execution history.

#### Acceptance Criteria

1. WHEN a user navigates to a node detail page THEN the system SHALL query PuppetDB for recent Puppet reports for that node
2. WHEN PuppetDB returns reports THEN the system SHALL display them in reverse chronological order alongside other execution history
3. WHEN displaying a report THEN the system SHALL show the run timestamp, status (success, failure, unchanged), and resource change summary
4. WHEN a user selects a report THEN the system SHALL display detailed information including changed resources, logs, and metrics
5. WHERE reports contain errors THEN the system SHALL highlight failed resources and error messages prominently

### Requirement 4

**User Story:** As an infrastructure administrator, I want to view Puppet catalogs from PuppetDB on the node detail page, so that I can understand the desired state configuration for each node.

#### Acceptance Criteria

1. WHEN a user navigates to a node detail page THEN the system SHALL query PuppetDB for the latest catalog for that node
2. WHEN PuppetDB returns a catalog THEN the system SHALL display the catalog resources in a structured, browsable format
3. WHEN displaying catalog resources THEN the system SHALL organize them by resource type with filtering and search capabilities
4. WHEN a user selects a catalog resource THEN the system SHALL display the resource parameters and relationships
5. WHEN catalog data is displayed THEN the system SHALL show the catalog compilation timestamp and environment

### Requirement 5

**User Story:** As an infrastructure administrator, I want to view Puppet events from PuppetDB on the node detail page, so that I can track individual resource changes and troubleshoot issues.

#### Acceptance Criteria

1. WHEN a user navigates to a node detail page THEN the system SHALL query PuppetDB for recent events for that node
2. WHEN PuppetDB returns events THEN the system SHALL display them in reverse chronological order with filtering by event type
3. WHEN displaying events THEN the system SHALL show the event timestamp, resource, status (success, failure, noop), and message
4. WHERE events represent failures THEN the system SHALL highlight them prominently with error details
5. WHEN a user filters events THEN the system SHALL support filtering by status, resource type, and time range

### Requirement 6

**User Story:** As an infrastructure administrator, I want to configure PuppetDB connection settings, so that I can connect Padawi to my PuppetDB instance securely.

#### Acceptance Criteria

1. WHEN the system starts THEN Padawi SHALL read PuppetDB connection configuration from environment variables or configuration files
2. WHERE PuppetDB uses HTTPS THEN the system SHALL support SSL certificate validation with options for custom CA certificates
3. WHERE PuppetDB requires authentication THEN the system SHALL support token-based authentication
4. WHEN PuppetDB configuration is invalid THEN the system SHALL log detailed error messages for troubleshooting
5. WHEN PuppetDB is not configured THEN the system SHALL operate normally without PuppetDB features enabled

### Requirement 7

**User Story:** As an infrastructure administrator, I want to re-execute a previously run action with the same parameters, so that I can quickly repeat operations without manually re-entering all settings.

#### Acceptance Criteria

1. WHEN viewing an execution in the executions page THEN the system SHALL display a re-execute button for all action types (commands, tasks, plans)
2. WHEN a user clicks the re-execute button THEN the system SHALL navigate to the appropriate execution interface with all previous parameters pre-filled
3. WHEN re-executing an action THEN the system SHALL preserve the target nodes, action type, and all parameters from the original execution
4. WHEN re-executing an action THEN the system SHALL allow the user to modify any parameters before execution
5. WHEN an action is re-executed THEN the system SHALL create a new execution record with a reference to the original execution

### Requirement 8

**User Story:** As an infrastructure administrator, I want to re-execute an action from the node detail page, so that I can quickly repeat operations on a specific node.

#### Acceptance Criteria

1. WHEN viewing a node detail page with execution history THEN the system SHALL display a re-execute button for each action execution
2. WHEN a user clicks the re-execute button on a node detail page THEN the system SHALL navigate to the appropriate execution interface with the node and parameters pre-filled
3. WHEN re-executing from a node detail page THEN the system SHALL preserve the action type and all parameters
4. WHEN re-executing from a node detail page THEN the system SHALL set the target node to the current node being viewed

### Requirement 9

**User Story:** As an infrastructure administrator, I want an improved home page design, so that I can quickly access common operations and understand system status at a glance.

#### Acceptance Criteria

1. WHEN a user visits the home page THEN the system SHALL display a dashboard with quick access to inventory, executions, and common operations
2. WHEN displaying the home page THEN the system SHALL show summary statistics (total nodes, recent executions, success rate) from all integrated sources
3. WHEN displaying the home page THEN the system SHALL provide quick action buttons for common operations across different execution tools
4. WHEN displaying the home page THEN the system SHALL show recent execution activity with status indicators and source attribution
5. WHERE integration sources are configured THEN the home page SHALL display connection status for each source (PuppetDB, etc.)

### Requirement 10

**User Story:** As an infrastructure administrator, I want an enhanced node detail page layout, so that I can efficiently navigate between different types of node information from multiple sources.

#### Acceptance Criteria

1. WHEN a user views a node detail page THEN the system SHALL organize information into clearly labeled tabs or sections (Overview, Facts, Execution History, Puppet Reports, Catalog, Events)
2. WHEN displaying node information THEN the system SHALL clearly indicate the source of each data type (Bolt, PuppetDB, etc.)
3. WHEN switching between tabs THEN the system SHALL preserve the current node context and load data on demand
4. WHEN displaying node information THEN the system SHALL use consistent styling and layout patterns across all tabs
5. WHEN loading node data THEN the system SHALL show loading indicators for each section independently without blocking other sections

### Requirement 11

**User Story:** As an infrastructure administrator, I want consistent and polished UI styling throughout the application, so that I have a professional and intuitive user experience across all integrated tools.

#### Acceptance Criteria

1. WHEN using the application THEN the system SHALL apply consistent color schemes, typography, and spacing across all pages and integrated tools
2. WHEN displaying status information THEN the system SHALL use consistent status badges and icons with clear visual hierarchy
3. WHEN displaying buttons and interactive elements THEN the system SHALL provide clear hover states, focus indicators, and visual feedback
4. WHEN displaying errors or warnings THEN the system SHALL use consistent alert styling, positioning, and dismissal patterns
5. WHEN the application loads THEN the system SHALL use consistent loading indicators and skeleton screens for all data sources

### Requirement 12

**User Story:** As a developer, I want a well-defined integration architecture for PuppetDB, so that the system can reliably query and process PuppetDB data and serve as a pattern for future integrations.

#### Acceptance Criteria

1. WHEN the backend starts THEN the system SHALL initialize integration clients (PuppetDB, etc.) using a plugin-based architecture
2. WHEN querying PuppetDB THEN the system SHALL use the PuppetDB query language (PQL) for efficient data retrieval
3. WHEN integration queries fail THEN the system SHALL implement retry logic with exponential backoff and circuit breaker patterns
4. WHEN processing integration responses THEN the system SHALL validate and transform data into normalized application formats
5. WHEN integration data is cached THEN the system SHALL implement appropriate cache expiration policies with per-source TTL configuration

### Requirement 13

**User Story:** As an infrastructure administrator, I want to see the full command output and the exact command line used when expert mode is enabled, so that I can debug issues, understand what commands are being executed, and have complete visibility into system operations.

#### Acceptance Criteria

1. WHEN expert mode is enabled AND a user initiates an execution THEN the system SHALL display the complete command line that will be executed before the execution starts, allowing the user to review it
2. WHEN expert mode is enabled AND an execution is in progress THEN the system SHALL keep the command line visible alongside the streaming output
3. WHEN expert mode is enabled AND an execution completes THEN the system SHALL display the complete command line that was executed including all arguments and options
4. WHEN expert mode is enabled AND viewing execution results THEN the system SHALL display the full stdout and stderr output without truncation or summarization
5. WHEN expert mode is enabled AND viewing execution history THEN the system SHALL show the executed command line for each execution record
6. WHEN expert mode is enabled AND viewing node detail execution history THEN the system SHALL display the command line alongside execution results
7. WHEN expert mode is disabled THEN the system SHALL display summarized output and hide technical command details to maintain a simplified user interface
8. WHEN displaying command output in expert mode THEN the system SHALL preserve formatting, line breaks, and special characters exactly as received
9. WHEN displaying command lines THEN the system SHALL use monospace font and syntax highlighting to improve readability
10. WHEN command output is very long THEN the system SHALL provide scrolling and search capabilities while maintaining the complete output visible
