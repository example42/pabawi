# Expert Mode Testing Flow Diagram

## Testing Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Testing Tools Suite                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│   Automated   │    │  Interactive   │    │    Manual    │
│     Script    │    │     Tester     │    │   Testing    │
│               │    │                │    │              │
│ Tests all 58  │    │ Test specific  │    │ Follow guide │
│    routes     │    │    routes      │    │  step-by-step│
└───────┬───────┘    └────────┬───────┘    └──────┬───────┘
        │                     │                     │
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Backend Server  │
                    │  (localhost:3000)│
                    └──────────────────┘
                              │
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│   Inventory   │    │    PuppetDB    │    │ Puppetserver │
│   Routes (3)  │    │  Routes (11)   │    │  Routes (14) │
└───────────────┘    └────────────────┘    └──────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│     Hiera     │    │   Executions   │    │    Tasks     │
│  Routes (13)  │    │   Routes (6)   │    │  Routes (3)  │
└───────────────┘    └────────────────┘    └──────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│   Commands    │    │    Packages    │    │    Facts     │
│   Routes (1)  │    │   Routes (2)   │    │  Routes (1)  │
└───────────────┘    └────────────────┘    └──────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│    Puppet     │    │   Streaming    │    │    Status    │
│   Routes (1)  │    │   Routes (2)   │    │  Routes (1)  │
└───────────────┘    └────────────────┘    └──────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Test Results    │
                    │  - Console       │
                    │  - Results File  │
                    └──────────────────┘
```

## Test Execution Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    Start Testing                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ Check Server     │
                    │ Running?         │
                    └────────┬─────────┘
                             │
                    ┌────────┴────────┐
                    │                 │
                    ▼                 ▼
              ┌──────────┐      ┌──────────┐
              │   Yes    │      │    No    │
              └────┬─────┘      └────┬─────┘
                   │                 │
                   │                 ▼
                   │           ┌──────────┐
                   │           │  Error:  │
                   │           │  Start   │
                   │           │  Server  │
                   │           └──────────┘
                   │
                   ▼
         ┌──────────────────┐
         │  For Each Route  │
         └────────┬─────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Test with Expert Mode ON   │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Send HTTP Request          │
    │  Headers:                   │
    │  - X-Expert-Mode: true      │
    │  - X-Correlation-ID: xxx    │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Receive Response           │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Validate Response          │
    │  - Is valid JSON?           │
    │  - Has _debug field?        │
    │  - Has required fields?     │
    │  - Has errors array?        │
    └─────────────┬───────────────┘
                  │
         ┌────────┴────────┐
         │                 │
         ▼                 ▼
    ┌────────┐        ┌────────┐
    │  Pass  │        │  Fail  │
    └────┬───┘        └────┬───┘
         │                 │
         └────────┬────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Test with Expert Mode OFF  │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Send HTTP Request          │
    │  (No expert mode header)    │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Receive Response           │
    └─────────────┬───────────────┘
                  │
                  ▼
    ┌─────────────────────────────┐
    │  Validate Response          │
    │  - Is valid JSON?           │
    │  - NO _debug field?         │
    └─────────────┬───────────────┘
                  │
         ┌────────┴────────┐
         │                 │
         ▼                 ▼
    ┌────────┐        ┌────────┐
    │  Pass  │        │  Fail  │
    └────┬───┘        └────┬───┘
         │                 │
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │  Record Result  │
         └────────┬────────┘
                  │
                  ▼
         ┌─────────────────┐
         │  More Routes?   │
         └────────┬────────┘
                  │
         ┌────────┴────────┐
         │                 │
         ▼                 ▼
    ┌────────┐        ┌────────┐
    │   Yes  │        │   No   │
    └────┬───┘        └────┬───┘
         │                 │
         │                 ▼
         │        ┌─────────────────┐
         │        │  Generate       │
         │        │  Summary        │
         │        └────────┬────────┘
         │                 │
         │                 ▼
         │        ┌─────────────────┐
         │        │  Write Results  │
         │        │  File           │
         │        └────────┬────────┘
         │                 │
         │                 ▼
         │        ┌─────────────────┐
         │        │  Display        │
         │        │  Statistics     │
         │        └────────┬────────┘
         │                 │
         │                 ▼
         │        ┌─────────────────┐
         │        │  Exit           │
         │        │  (0=pass, 1=fail)│
         │        └─────────────────┘
         │
         └──────────────┐
                        │
                        ▼
              ┌──────────────────┐
              │  Next Route      │
              └──────────────────┘
```

## Expert Mode Request Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    Client Request                           │
│  Headers:                                                   │
│  - X-Expert-Mode: true                                      │
│  - X-Correlation-ID: test-001                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend Route                            │
│                                                             │
│  1. Check expert mode flag                                 │
│  2. Create debugInfo if enabled                            │
│  3. Add info/debug messages during processing              │
│  4. Perform operation                                      │
│  5. Catch errors and add to debugInfo                      │
│  6. Attach debugInfo to response                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Response                                 │
│                                                             │
│  Success Response:                                          │
│  {                                                          │
│    "data": { ... },                                         │
│    "_debug": {                                              │
│      "timestamp": "...",                                    │
│      "operation": "...",                                    │
│      "duration": 123,                                       │
│      "errors": [],                                          │
│      "warnings": [],                                        │
│      "info": [...],                                         │
│      "performance": {...}                                   │
│    }                                                        │
│  }                                                          │
│                                                             │
│  Error Response:                                            │
│  {                                                          │
│    "error": "...",                                          │
│    "_debug": {                                              │
│      "timestamp": "...",                                    │
│      "operation": "...",                                    │
│      "duration": 123,                                       │
│      "errors": [                                            │
│        {                                                    │
│          "message": "...",                                  │
│          "stack": "...",                                    │
│          "level": "error"                                   │
│        }                                                    │
│      ],                                                     │
│      "warnings": [],                                        │
│      "info": [],                                            │
│      "performance": {...}                                   │
│    }                                                        │
│  }                                                          │
└─────────────────────────────────────────────────────────────┘
```

## Testing Tools Relationship

```
┌─────────────────────────────────────────────────────────────┐
│                    Documentation Layer                      │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ Testing Guide    │  │ Quick Reference  │               │
│  │ (Comprehensive)  │  │ (Concise)        │               │
│  └──────────────────┘  └──────────────────┘               │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ README           │  │ Checklist        │               │
│  │ (How-to)         │  │ (Printable)      │               │
│  └──────────────────┘  └──────────────────┘               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Execution Layer                          │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ Automated Script │  │ Interactive      │               │
│  │ (All routes)     │  │ Tester           │               │
│  │                  │  │ (Single route)   │               │
│  └──────────────────┘  └──────────────────┘               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Results Layer                            │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ Console Output   │  │ Results File     │               │
│  │ (Colored)        │  │ (Detailed)       │               │
│  └──────────────────┘  └──────────────────┘               │
└─────────────────────────────────────────────────────────────┘
```

## Route Testing Coverage

```
                    Total Routes: 58
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │Inventory│      │PuppetDB │      │Puppetsrv│
   │   (3)   │      │  (11)   │      │  (14)   │
   └─────────┘      └─────────┘      └─────────┘
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │  Hiera  │      │Execution│      │  Tasks  │
   │  (13)   │      │   (6)   │      │   (3)   │
   └─────────┘      └─────────┘      └─────────┘
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │Commands │      │Packages │      │  Facts  │
   │   (1)   │      │   (2)   │      │   (1)   │
   └─────────┘      └─────────┘      └─────────┘
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │ Puppet  │      │Streaming│      │ Status  │
   │   (1)   │      │   (2)   │      │   (1)   │
   └─────────┘      └─────────┘      └─────────┘
```

## Decision Tree: Which Tool to Use?

```
                    Need to test?
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
   All routes?      Single route?     Understand
                                      process?
        │                 │                 │
        ▼                 ▼                 ▼
   ┌─────────┐      ┌─────────┐      ┌─────────┐
   │Automated│      │Interactv│      │  Read   │
   │ Script  │      │ Tester  │      │  Guide  │
   └─────────┘      └─────────┘      └─────────┘
        │                 │                 │
        ▼                 ▼                 ▼
   Quick test       Detailed         Learn
   all routes       single route     patterns
```

## Success Criteria Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    Route Test                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ Expert Mode ON   │
                    └────────┬─────────┘
                             │
                    ┌────────┴────────┐
                    │                 │
                    ▼                 ▼
              ┌──────────┐      ┌──────────┐
              │ _debug   │      │ Required │
              │ present? │      │ fields?  │
              └────┬─────┘      └────┬─────┘
                   │                 │
                   ▼                 ▼
              ┌──────────┐      ┌──────────┐
              │   Yes    │      │   Yes    │
              └────┬─────┘      └────┬─────┘
                   │                 │
                   └────────┬────────┘
                            │
                            ▼
                  ┌──────────────────┐
                  │ Expert Mode OFF  │
                  └────────┬─────────┘
                           │
                           ▼
                  ┌──────────────────┐
                  │ _debug absent?   │
                  └────────┬─────────┘
                           │
                           ▼
                      ┌────────┐
                      │  Yes   │
                      └────┬───┘
                           │
                           ▼
                  ┌──────────────────┐
                  │   TEST PASSED    │
                  └──────────────────┘
```

## Legend

```
┌─────────┐
│  Box    │  = Process or Component
└─────────┘

    │
    ▼         = Flow Direction

┌───┴───┐
│       │     = Decision Point
└───┬───┘

┌─────────┐
│  (N)    │  = Count of items
└─────────┘
```
