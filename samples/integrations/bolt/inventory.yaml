# ===========================================================================
# Pabawi Demo â€” Bolt Inventory
# A realistic multi-tier infrastructure across production, staging, and dev
# ===========================================================================

groups:
  # -----------------------------------------------------------------------
  # PRODUCTION ENVIRONMENT
  # -----------------------------------------------------------------------
  - name: production
    groups:

      # --- Web Tier ---
      - name: production_webservers
        targets:
          - name: web-prod-1.acme.internal
            uri: 10.100.1.10
            alias: web-prod-1
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              os_family: Debian
              application: nginx
              pool: blue
          - name: web-prod-2.acme.internal
            uri: 10.100.1.11
            alias: web-prod-2
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              os_family: Debian
              application: nginx
              pool: green
          - name: web-prod-3.acme.internal
            uri: 10.200.1.10
            alias: web-prod-3
            vars:
              role: webserver
              datacenter: eu-west-1
              tier: frontend
              os_family: Debian
              application: nginx
              pool: blue
          - name: web-prod-4.acme.internal
            uri: 10.200.1.11
            alias: web-prod-4
            vars:
              role: webserver
              datacenter: eu-west-1
              tier: frontend
              os_family: Debian
              application: nginx
              pool: green
        config:
          ssh:
            user: deploy

      # --- Load Balancers ---
      - name: production_loadbalancers
        targets:
          - name: lb-prod-1.acme.internal
            uri: 10.100.1.5
            alias: lb-prod-1
            vars:
              role: loadbalancer
              datacenter: us-east-1
              tier: frontend
              application: haproxy
              vip: 10.100.1.100
          - name: lb-prod-2.acme.internal
            uri: 10.200.1.5
            alias: lb-prod-2
            vars:
              role: loadbalancer
              datacenter: eu-west-1
              tier: frontend
              application: haproxy
              vip: 10.200.1.100
        config:
          ssh:
            user: deploy

      # --- Application Tier ---
      - name: production_appservers
        targets:
          - name: app-rails-prod-1.acme.internal
            uri: 10.100.2.10
            alias: app-rails-1
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              os_family: Debian
              runtime: ruby
              application: rails
              app_port: 3000
          - name: app-rails-prod-2.acme.internal
            uri: 10.100.2.11
            alias: app-rails-2
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              os_family: Debian
              runtime: ruby
              application: rails
              app_port: 3000
          - name: app-java-prod-1.acme.internal
            uri: 10.100.2.20
            alias: app-java-1
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              os_family: RedHat
              runtime: java
              application: spring-boot
              app_port: 8080
              jvm_heap: 4g
          - name: app-java-prod-2.acme.internal
            uri: 10.200.2.20
            alias: app-java-2
            vars:
              role: appserver
              datacenter: eu-west-1
              tier: application
              os_family: RedHat
              runtime: java
              application: spring-boot
              app_port: 8080
              jvm_heap: 4g
          - name: app-node-prod-1.acme.internal
            uri: 10.100.2.30
            alias: app-node-1
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              os_family: Debian
              runtime: nodejs
              application: express
              app_port: 4000
              node_version: "20"
        config:
          ssh:
            user: deploy

      # --- Database Tier ---
      - name: production_databases
        targets:
          - name: db-primary-prod-1.acme.internal
            uri: 10.100.3.10
            alias: db-primary-1
            vars:
              role: database
              datacenter: us-east-1
              tier: data
              os_family: RedHat
              engine: postgresql
              pg_version: "16"
              pg_role: primary
              pg_max_connections: 500
              pg_shared_buffers: 8GB
              backup_schedule: "0 2 * * *"
          - name: db-replica-prod-1.acme.internal
            uri: 10.100.3.11
            alias: db-replica-1
            vars:
              role: database
              datacenter: us-east-1
              tier: data
              os_family: RedHat
              engine: postgresql
              pg_version: "16"
              pg_role: replica
              pg_upstream: db-primary-prod-1.acme.internal
              pg_max_connections: 200
          - name: db-replica-prod-2.acme.internal
            uri: 10.200.3.11
            alias: db-replica-2
            vars:
              role: database
              datacenter: eu-west-1
              tier: data
              os_family: RedHat
              engine: postgresql
              pg_version: "16"
              pg_role: replica
              pg_upstream: db-primary-prod-1.acme.internal
              pg_max_connections: 200
          - name: redis-prod-1.acme.internal
            uri: 10.100.3.20
            alias: redis-1
            vars:
              role: cache
              datacenter: us-east-1
              tier: data
              os_family: RedHat
              engine: redis
              redis_maxmemory: 4gb
              redis_role: master
          - name: redis-prod-2.acme.internal
            uri: 10.100.3.21
            alias: redis-2
            vars:
              role: cache
              datacenter: us-east-1
              tier: data
              os_family: RedHat
              engine: redis
              redis_maxmemory: 4gb
              redis_role: replica
          - name: redis-prod-3.acme.internal
            uri: 10.200.3.20
            alias: redis-3
            vars:
              role: cache
              datacenter: eu-west-1
              tier: data
              os_family: RedHat
              engine: redis
              redis_maxmemory: 4gb
              redis_role: replica
        config:
          ssh:
            user: dbadmin
            run-as: root

      # --- Monitoring ---
      - name: production_monitoring
        targets:
          - name: mon-prometheus-prod-1.acme.internal
            uri: 10.100.4.10
            alias: prometheus-1
            vars:
              role: monitoring
              datacenter: us-east-1
              tier: infrastructure
              application: prometheus
              retention_days: 90
              scrape_interval: 15s
          - name: mon-grafana-prod-1.acme.internal
            uri: 10.100.4.11
            alias: grafana-1
            vars:
              role: monitoring
              datacenter: us-east-1
              tier: infrastructure
              application: grafana
              grafana_port: 3000
          - name: mon-alertmanager-prod-1.acme.internal
            uri: 10.100.4.12
            alias: alertmanager-1
            vars:
              role: monitoring
              datacenter: us-east-1
              tier: infrastructure
              application: alertmanager
              slack_channel: "#ops-alerts"
        config:
          ssh:
            user: monitor

      # --- Windows ---
      - name: production_windows
        targets:
          - name: win-ad-prod-1.acme.internal
            uri: 10.100.5.10
            alias: win-ad-1
            vars:
              role: domain_controller
              datacenter: us-east-1
              tier: infrastructure
              os_family: windows
              windows_version: "2022"
              ad_domain: acme.internal
          - name: win-iis-prod-1.acme.internal
            uri: 10.100.5.20
            alias: win-iis-1
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              os_family: windows
              windows_version: "2022"
              application: iis
              dotnet_version: "8.0"
          - name: win-iis-prod-2.acme.internal
            uri: 10.200.5.20
            alias: win-iis-2
            vars:
              role: webserver
              datacenter: eu-west-1
              tier: frontend
              os_family: windows
              windows_version: "2022"
              application: iis
              dotnet_version: "8.0"
        config:
          transport: winrm
          winrm:
            user: Administrator
            ssl: true
            ssl-verify: false

    vars:
      environment: production
      puppet_environment: production
      ntp_servers:
        - 0.pool.ntp.org
        - 1.pool.ntp.org
      dns_servers:
        - 10.100.0.2
        - 10.200.0.2
      syslog_server: syslog.acme.internal

  # -----------------------------------------------------------------------
  # STAGING ENVIRONMENT
  # -----------------------------------------------------------------------
  - name: staging
    groups:
      - name: staging_webservers
        targets:
          - name: web-stg-1.acme.internal
            uri: 172.16.1.10
            alias: web-stg-1
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              application: nginx
          - name: web-stg-2.acme.internal
            uri: 172.16.1.11
            alias: web-stg-2
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              application: nginx

      - name: staging_appservers
        targets:
          - name: app-rails-stg-1.acme.internal
            uri: 172.16.2.10
            alias: app-rails-stg-1
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              runtime: ruby
              application: rails
              app_port: 3000
          - name: app-java-stg-1.acme.internal
            uri: 172.16.2.20
            alias: app-java-stg-1
            vars:
              role: appserver
              datacenter: us-east-1
              tier: application
              runtime: java
              application: spring-boot
              app_port: 8080
              jvm_heap: 2g

      - name: staging_databases
        targets:
          - name: db-primary-stg-1.acme.internal
            uri: 172.16.3.10
            alias: db-stg-1
            vars:
              role: database
              datacenter: us-east-1
              tier: data
              engine: postgresql
              pg_version: "16"
              pg_role: primary
              pg_max_connections: 100
          - name: redis-stg-1.acme.internal
            uri: 172.16.3.20
            alias: redis-stg-1
            vars:
              role: cache
              datacenter: us-east-1
              tier: data
              engine: redis
              redis_maxmemory: 1gb
              redis_role: master

      - name: staging_monitoring
        targets:
          - name: mon-stg-1.acme.internal
            uri: 172.16.4.10
            alias: mon-stg-1
            vars:
              role: monitoring
              datacenter: us-east-1
              tier: infrastructure
              application: prometheus

      - name: staging_windows
        targets:
          - name: win-iis-stg-1.acme.internal
            uri: 172.16.5.20
            alias: win-iis-stg-1
            vars:
              role: webserver
              datacenter: us-east-1
              tier: frontend
              os_family: windows
              application: iis
        config:
          transport: winrm
          winrm:
            user: Administrator
            ssl: true
            ssl-verify: false

    vars:
      environment: staging
      puppet_environment: staging
      ntp_servers:
        - 0.pool.ntp.org
      dns_servers:
        - 172.16.0.2
      syslog_server: syslog-stg.acme.internal
    config:
      ssh:
        user: deploy

  # -----------------------------------------------------------------------
  # DEVELOPMENT ENVIRONMENT
  # -----------------------------------------------------------------------
  - name: development
    groups:
      - name: dev_workloads
        targets:
          - name: dev-web-1.acme.internal
            uri: 192.168.10.10
            alias: dev-web-1
            vars:
              role: webserver
              tier: frontend
              application: nginx
          - name: dev-app-1.acme.internal
            uri: 192.168.10.20
            alias: dev-app-1
            vars:
              role: appserver
              tier: application
              runtime: ruby
              application: rails
              app_port: 3000
          - name: dev-db-1.acme.internal
            uri: 192.168.10.30
            alias: dev-db-1
            vars:
              role: database
              tier: data
              engine: postgresql
              pg_version: "16"
              pg_role: primary

      - name: dev_ci
        targets:
          - name: ci-jenkins-1.acme.internal
            uri: 192.168.10.50
            alias: jenkins-1
            vars:
              role: ci_controller
              tier: infrastructure
              application: jenkins
              jenkins_port: 8080
              executor_count: 0
          - name: ci-agent-1.acme.internal
            uri: 192.168.10.51
            alias: ci-agent-1
            vars:
              role: ci_agent
              tier: infrastructure
              application: jenkins-agent
              executor_count: 4
              labels:
                - docker
                - linux
                - amd64
          - name: ci-agent-2.acme.internal
            uri: 192.168.10.52
            alias: ci-agent-2
            vars:
              role: ci_agent
              tier: infrastructure
              application: jenkins-agent
              executor_count: 4
              labels:
                - docker
                - linux
                - arm64

    vars:
      environment: development
      puppet_environment: development
      dns_servers:
        - 192.168.10.2
    config:
      ssh:
        user: vagrant

  # -----------------------------------------------------------------------
  # EDGE / CDN NODES
  # -----------------------------------------------------------------------
  - name: edge
    targets:
      - name: edge-nyc-1.acme.internal
        uri: 10.50.1.10
        alias: edge-nyc
        vars:
          role: cdn_cache
          pop: nyc
          tier: frontend
          application: varnish
          cache_size: 32g
      - name: edge-lax-1.acme.internal
        uri: 10.50.2.10
        alias: edge-lax
        vars:
          role: cdn_cache
          pop: lax
          tier: frontend
          application: varnish
          cache_size: 32g
      - name: edge-ams-1.acme.internal
        uri: 10.50.3.10
        alias: edge-ams
        vars:
          role: cdn_cache
          pop: ams
          tier: frontend
          application: varnish
          cache_size: 64g
      - name: edge-sin-1.acme.internal
        uri: 10.50.4.10
        alias: edge-sin
        vars:
          role: cdn_cache
          pop: sin
          tier: frontend
          application: varnish
          cache_size: 32g
    vars:
      environment: production
      puppet_environment: production
    config:
      ssh:
        user: deploy

  # -----------------------------------------------------------------------
  # NETWORK DEVICES
  # -----------------------------------------------------------------------
  - name: network
    targets:
      - name: fw-prod-1.acme.internal
        uri: 10.100.0.1
        alias: fw-prod-1
        vars:
          role: firewall
          datacenter: us-east-1
          vendor: pfsense
          tier: network
      - name: fw-prod-2.acme.internal
        uri: 10.200.0.1
        alias: fw-prod-2
        vars:
          role: firewall
          datacenter: eu-west-1
          vendor: pfsense
          tier: network
      - name: sw-core-1.acme.internal
        uri: 10.100.0.10
        alias: sw-core-1
        vars:
          role: switch
          datacenter: us-east-1
          vendor: arista
          tier: network
          vlan_range: "100-199"
      - name: sw-core-2.acme.internal
        uri: 10.200.0.10
        alias: sw-core-2
        vars:
          role: switch
          datacenter: eu-west-1
          vendor: arista
          tier: network
          vlan_range: "200-299"
    config:
      ssh:
        user: netadmin
        connect-timeout: 10

# ===========================================================================
# GLOBAL DEFAULTS
# ===========================================================================
config:
  transport: ssh
  ssh:
    user: deploy
    private-key: ~/.ssh/id_ed25519
    native-ssh: true
    run-as: root
    run-as-command:
      - sudo
      - "-nkSEu"
    port: 22
    host-key-check: false
    connect-timeout: 30
    disconnect-timeout: 5
